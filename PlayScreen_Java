package com.ec327.android.tuneplay;

import android.content.Intent;
import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.view.View;
import android.media.MediaPlayer;
import android.widget.Button;
import com.ec327.android.tuneplay.HomeScreen;
import java.util.Random;



public class PlayScreen extends AppCompatActivity {

    int[] songArray;
    int Size;
    int Count = 0;
    boolean donePlaying = false;

    // get level number with dot operator: HomeScreen.level
    // level is initialized to 1 when Home Screen is created

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_play_screen);

        //Initialize Song Arrays
        int[] Song1 = new int[0];
        int[] Song2 = new int[0];
        int[] Song3 = new int[0];

        if(HomeScreen.level == 1) {
            //Creates arrays representing the songs for level 1
            Song1 = new int[]{1, 2, 3};
            Song2 = new int[]{4, 5, 6};
            Song3 = new int[]{5, 1, 5};
            Size = 3;

        }
        else if(HomeScreen.level == 2) {
            //Creates arrays representing the songs for level 2
            Song1 = new int[]{1, 2, 3, 2, 1, 6};
            Song2 = new int[]{4, 4, 5, 6, 6, 5};
            Song3 = new int[]{1, 5, 4, 1, 2, 3};
            Size = 6;
        }

        //Randomly plays one of the songs
        Random randGen = new Random();
        int randInt = randGen.nextInt(3);
        if(randInt == 0){
            songArray = Song1;
        }
        else if(randInt == 1){
            songArray = Song2;
        }
        else if(randInt == 2) {
            songArray = Song3;
        }
    }

    public void playP1(View view){
        // code to produce sound when left piano key is clicked
        MediaPlayer p1 = MediaPlayer.create(getApplicationContext(), R.raw.piano_g3);
        p1.start();
        if(donePlaying) {
            check(1);
        }
    }

    public void playP2(View view){
        // code to produce sound when middle piano key is clicked
        MediaPlayer p2 = MediaPlayer.create(getApplicationContext(), R.raw.piano_a3);
        p2.start();
        if(donePlaying) {
            check(2);
        }
    }

    public void playP3(View view){
        // code to produce sound when right piano key is clicked
        MediaPlayer p3 = MediaPlayer.create(getApplicationContext(), R.raw.piano_b3);
        p3.start();
        if(donePlaying) {
            check(3);
        }
    }

    public void playG1(View view){
        // code to produce sound when top guitar string is clicked
        MediaPlayer g1 = MediaPlayer.create(getApplicationContext(), R.raw.guitar_c);
        g1.start();
        if(donePlaying) {
            check(4);
        }
    }

    public void playG2(View view){
        // code to produce sound when bottom guitar string is clicked
        MediaPlayer g2 = MediaPlayer.create(getApplicationContext(), R.raw.guitar_d);
        g2.start();
        if(donePlaying) {
            check(5);
        }
    }

    public void playD1(View view){
        // code to produce sound when left drum is clicked
        MediaPlayer d1 = MediaPlayer.create(getApplicationContext(), R.raw.snare);
        d1.start();
        if(donePlaying) {
            check(6);
        }
    }

    public void playD2(View view){
        // code to produce sound when right drum is clicked
        MediaPlayer d2 = MediaPlayer.create(getApplicationContext(), R.raw.cymbal);
        d2.start();
        if(donePlaying) {
            check(7);
        }
    }

    public void playSongFunc(int[] CurrentSong, int Size){
        for(int i = 0; i<Size; i=i+1){
            switch(CurrentSong[i]) {
                case 1:
                    playP1(findViewById(R.id.pianoOne));
                    break;
                case 2:
                    playP2(findViewById(R.id.pianoTwo));
                    break;
                case 3:
                    playP3(findViewById(R.id.pianoThree));
                    break;
                case 4:
                    playG1(findViewById(R.id.guitarOne));
                    break;
                case 5:
                    playG2(findViewById(R.id.guitarTwo));
                    break;
                case 6:
                    playD1(findViewById(R.id.drumOne));
                    break;
                case 7:
                    playD2(findViewById(R.id.drumTwo));
                    break;
            }

            try {
                Thread.sleep(500);
            }
            catch(InterruptedException ex) {
                Thread.currentThread().interrupt();
            }

        }
        donePlaying = true;
    }

    public void showMe(View view){
        // code to show user the tune
        playSongFunc(songArray, Size);
    }


    void check(int butpress){
        // checks user input against array
        if(butpress == songArray[Count]){
            Count = Count+1;
            if(Count == Size){
                //Next level screen
                HomeScreen.level = HomeScreen.level + 1;
                Intent goToNextLevel = new Intent(this, nextLevelScreen.class);
                startActivity(goToNextLevel);
            }
        }
        else {
            // Game Over
            Intent goToGameOver = new Intent(this, gameOverScreen.class);
            startActivity(goToGameOver);
        }
    }
}
